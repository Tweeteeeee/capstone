<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_80) on Thu Sep 28 12:40:38 CDT 2017 -->
<title>ActiveRepairService.ParentRepairSession (apache-cassandra API)</title>
<meta name="date" content="2017-09-28">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="ActiveRepairService.ParentRepairSession (apache-cassandra API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ActiveRepairService.ParentRepairSession.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/cassandra/service/ActiveRepairService.html" title="class in org.apache.cassandra.service"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/cassandra/service/ActiveRepairService.Status.html" title="enum in org.apache.cassandra.service"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html" target="_top">Frames</a></li>
<li><a href="ActiveRepairService.ParentRepairSession.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.cassandra.service</div>
<h2 title="Class ActiveRepairService.ParentRepairSession" class="title">Class ActiveRepairService.ParentRepairSession</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.cassandra.service.ActiveRepairService.ParentRepairSession</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>Enclosing class:</dt>
<dd><a href="../../../../org/apache/cassandra/service/ActiveRepairService.html" title="class in org.apache.cassandra.service">ActiveRepairService</a></dd>
</dl>
<hr>
<br>
<pre>public static class <span class="strong">ActiveRepairService.ParentRepairSession</span>
extends java.lang.Object</pre>
<div class="block">We keep a ParentRepairSession around for the duration of the entire repair, for example, on a 256 token vnode rf=3 cluster
 we would have 768 RepairSession but only one ParentRepairSession. We use the PRS to avoid anticompacting the sstables
 768 times, instead we take all repaired ranges at the end of the repair and anticompact once.

 We do an optimistic marking of sstables - when we start an incremental repair we mark all unrepaired sstables as
 repairing (@see markSSTablesRepairing), then while the repair is ongoing compactions might remove those sstables,
 and when it is time for anticompaction we will only anticompact the sstables that are still on disk.

 Note that validation and streaming do not care about which sstables we have marked as repairing - they operate on
 all unrepaired sstables (if it is incremental), otherwise we would not get a correct repair.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>java.util.Map&lt;java.util.UUID,<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#columnFamilyStores">columnFamilyStores</a></strong></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.net.InetAddress</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#coordinator">coordinator</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#failed">failed</a></strong></code>
<div class="block">Used to mark a repair as failed - if the coordinator thinks that the repair is still ongoing and sends a
 request, we need to fail the coordinator as well.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#ranges">ranges</a></strong></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#repairedAt">repairedAt</a></strong></code>
<div class="block">used as fail time if failed is true</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.util.Map&lt;java.util.UUID,java.util.Set&lt;java.lang.String&gt;&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#sstableMap">sstableMap</a></strong></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#ActiveRepairService.ParentRepairSession(java.net.InetAddress,%20java.util.List,%20java.util.Collection,%20long)">ActiveRepairService.ParentRepairSession</a></strong>(java.net.InetAddress&nbsp;coordinator,
                                       java.util.List&lt;<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt;&nbsp;columnFamilyStores,
                                       java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt;&nbsp;ranges,
                                       long&nbsp;repairedAt)</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#ActiveRepairService.ParentRepairSession(java.net.InetAddress,%20java.util.List,%20java.util.Collection,%20long,%20boolean)">ActiveRepairService.ParentRepairSession</a></strong>(java.net.InetAddress&nbsp;coordinator,
                                       java.util.List&lt;<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt;&nbsp;columnFamilyStores,
                                       java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt;&nbsp;ranges,
                                       long&nbsp;repairedAt,
                                       boolean&nbsp;failed)</code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html" title="class in org.apache.cassandra.service">ActiveRepairService.ParentRepairSession</a></code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#asFailed()">asFailed</a></strong>()</code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../../org/apache/cassandra/utils/concurrent/Refs.html" title="class in org.apache.cassandra.utils.concurrent">Refs</a>&lt;<a href="../../../../org/apache/cassandra/io/sstable/SSTableReader.html" title="class in org.apache.cassandra.io.sstable">SSTableReader</a>&gt;</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#getActiveRepairedSSTableRefsForAntiCompaction(java.util.UUID)">getActiveRepairedSSTableRefsForAntiCompaction</a></strong>(java.util.UUID&nbsp;cfId)</code>
<div class="block">Gets the repairing sstables for anticompaction.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#markSSTablesRepairing(java.util.UUID,%20java.util.UUID)">markSSTablesRepairing</a></strong>(java.util.UUID&nbsp;cfId,
                     java.util.UUID&nbsp;parentSessionId)</code>
<div class="block">Marks all the unrepaired sstables as repairing unless we have already done so.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>java.lang.String</code></td>
<td class="colLast"><code><strong><a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html#toString()">toString</a></strong>()</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="columnFamilyStores">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>columnFamilyStores</h4>
<pre>public final&nbsp;java.util.Map&lt;java.util.UUID,<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt; columnFamilyStores</pre>
</li>
</ul>
<a name="ranges">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ranges</h4>
<pre>public final&nbsp;java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt; ranges</pre>
</li>
</ul>
<a name="sstableMap">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>sstableMap</h4>
<pre>public final&nbsp;java.util.Map&lt;java.util.UUID,java.util.Set&lt;java.lang.String&gt;&gt; sstableMap</pre>
</li>
</ul>
<a name="repairedAt">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>repairedAt</h4>
<pre>public final&nbsp;long repairedAt</pre>
<div class="block">used as fail time if failed is true</div>
</li>
</ul>
<a name="coordinator">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>coordinator</h4>
<pre>public final&nbsp;java.net.InetAddress coordinator</pre>
</li>
</ul>
<a name="failed">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>failed</h4>
<pre>public final&nbsp;boolean failed</pre>
<div class="block">Used to mark a repair as failed - if the coordinator thinks that the repair is still ongoing and sends a
 request, we need to fail the coordinator as well.</div>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="ActiveRepairService.ParentRepairSession(java.net.InetAddress, java.util.List, java.util.Collection, long, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ActiveRepairService.ParentRepairSession</h4>
<pre>public&nbsp;ActiveRepairService.ParentRepairSession(java.net.InetAddress&nbsp;coordinator,
                                       java.util.List&lt;<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt;&nbsp;columnFamilyStores,
                                       java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt;&nbsp;ranges,
                                       long&nbsp;repairedAt,
                                       boolean&nbsp;failed)</pre>
</li>
</ul>
<a name="ActiveRepairService.ParentRepairSession(java.net.InetAddress, java.util.List, java.util.Collection, long)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ActiveRepairService.ParentRepairSession</h4>
<pre>public&nbsp;ActiveRepairService.ParentRepairSession(java.net.InetAddress&nbsp;coordinator,
                                       java.util.List&lt;<a href="../../../../org/apache/cassandra/db/ColumnFamilyStore.html" title="class in org.apache.cassandra.db">ColumnFamilyStore</a>&gt;&nbsp;columnFamilyStores,
                                       java.util.Collection&lt;<a href="../../../../org/apache/cassandra/dht/Range.html" title="class in org.apache.cassandra.dht">Range</a>&lt;<a href="../../../../org/apache/cassandra/dht/Token.html" title="class in org.apache.cassandra.dht">Token</a>&gt;&gt;&nbsp;ranges,
                                       long&nbsp;repairedAt)</pre>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getActiveRepairedSSTableRefsForAntiCompaction(java.util.UUID)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getActiveRepairedSSTableRefsForAntiCompaction</h4>
<pre>public&nbsp;<a href="../../../../org/apache/cassandra/utils/concurrent/Refs.html" title="class in org.apache.cassandra.utils.concurrent">Refs</a>&lt;<a href="../../../../org/apache/cassandra/io/sstable/SSTableReader.html" title="class in org.apache.cassandra.io.sstable">SSTableReader</a>&gt;&nbsp;getActiveRepairedSSTableRefsForAntiCompaction(java.util.UUID&nbsp;cfId)</pre>
<div class="block">Gets the repairing sstables for anticompaction.

 Note that validation and streaming uses the real unrepaired sstables.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>cfId</code> - </dd>
<dt><span class="strong">Returns:</span></dt><dd></dd></dl>
</li>
</ul>
<a name="markSSTablesRepairing(java.util.UUID, java.util.UUID)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>markSSTablesRepairing</h4>
<pre>public&nbsp;void&nbsp;markSSTablesRepairing(java.util.UUID&nbsp;cfId,
                         java.util.UUID&nbsp;parentSessionId)</pre>
<div class="block">Marks all the unrepaired sstables as repairing unless we have already done so.

 Any of these sstables that are still on disk are then anticompacted once the streaming and validation phases are done.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>cfId</code> - </dd><dd><code>parentSessionId</code> - used to check that we don't start multiple inc repair sessions over the same sstables</dd></dl>
</li>
</ul>
<a name="asFailed()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>asFailed</h4>
<pre>public&nbsp;<a href="../../../../org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html" title="class in org.apache.cassandra.service">ActiveRepairService.ParentRepairSession</a>&nbsp;asFailed()</pre>
</li>
</ul>
<a name="toString()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>toString</h4>
<pre>public&nbsp;java.lang.String&nbsp;toString()</pre>
<dl>
<dt><strong>Overrides:</strong></dt>
<dd><code>toString</code>&nbsp;in class&nbsp;<code>java.lang.Object</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/ActiveRepairService.ParentRepairSession.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/cassandra/service/ActiveRepairService.html" title="class in org.apache.cassandra.service"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../../org/apache/cassandra/service/ActiveRepairService.Status.html" title="enum in org.apache.cassandra.service"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/cassandra/service/ActiveRepairService.ParentRepairSession.html" target="_top">Frames</a></li>
<li><a href="ActiveRepairService.ParentRepairSession.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &copy; 2017 The Apache Software Foundation</small></p>
</body>
</html>
